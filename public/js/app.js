(self.webpackChunk=self.webpackChunk||[]).push([[773],{8430:(t,e,n)=>{"use strict";var i=n(538),a=n(8345),s=new i.default;const r=i.default.extend({data:function(){return{remaining:0,remainingInterval:void 0}},created:function(){s.$on("modal-hidden",this.clearRemaining)},beforeDestroy:function(){s.$off("modal-hidden",this.clearRemaining)},methods:{initRemaining:function(t){var e=this;this.clearRemaining(),this.remaining=t,this.remaining<1||(this.remainingInterval=setInterval((function(){e.remaining-=1,e.remaining||e.clearRemaining()}),1e3))},clearRemaining:function(){this.remainingInterval&&(this.remainingInterval=clearInterval(this.remainingInterval))}}}),o=r.extend({data:function(){return{$modal:void 0,isEnabled:!1}},mounted:function(){var t=this;this.$modal=$(this.$el).on("show.bs.modal",(function(){s.$emit("modal-show"),t.isEnabled=!0})).on("hidden.bs.modal",(function(){s.$emit("modal-hidden"),t.isEnabled=!1}))},watch:{$route:function(){this.close()}},methods:{openAfterHidden:function(t){var e=!1,n=function n(){e||(e=!0,clearTimeout(i),t(),s.$off("modal-hidden",n))};s.$on("modal-hidden",n),this.close();var i=setTimeout(n,400)},close:function(){this.$modal.modal("hide")}}}),c=o.extend({props:["url","destroyUrl"],data:function(){return{page:1,data:{current_page:1,from:0,last_page:1,to:0,total:0}}},created:function(){s.$on("bookmark-click",this.open)},computed:{isEmpty:function(){return 0===this.data.total},hasPrev:function(){return this.data.current_page>1},hasNext:function(){return this.data.current_page<this.data.last_page}},methods:{open:function(){this.page=1,this.fetchData(!0)},fetchData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(e||this.isEnabled)&&axios.get(this.url,{params:{page:this.page}}).then((function(n){t.data=n.data,e&&t.$nextTick((function(){return t.$modal.modal()}))}))},move:function(t){s.$emit("starmap-move",t.x,t.y),this.close()},destroy:function(t){var e=this;axios.delete(this.destroyUrl.replace("__bookmark__",t.id)).then((function(){e.page>1&&e.data.to-e.data.from==0?e.prevPage():e.fetchData()}))},prevPage:function(){this.changePage(this.page-1)},nextPage:function(){this.changePage(this.page+1)},changePage:function(t){this.page!==t&&(t<1||t>this.data.last_page||(this.page=t,this.fetchData()))}}}),u=o.extend({props:["url","storeUrl","destroyUrl"],data:function(){return{isSubscribed:!1,canDemolish:!1,energy:0,selected:{id:void 0},grid:{id:void 0,building_id:void 0},data:{remaining:0,buildings:[]}}},created:function(){var t=this;s.$on("grid-click",this.open),s.$on("energy-updated",(function(e){t.energy=e})),s.$on("planet-update",(function(){return t.fetchData()}))},computed:{canConstruct:function(){return this.energy>=this.selected.construction_cost}},methods:{open:function(t){this.data={remaining:0,buildings:[]},this.selected={id:void 0},this.grid=t,this.fetchData(!0)},fetchData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(e||this.isEnabled)&&axios.get(this.url.replace("__grid__",this.grid.id)).then((function(n){t.data=n.data,t.data.buildings&&t.data.buildings.length&&(t.data.buildings=_.uniqBy(t.data.buildings,"id")),e&&t.data.buildings.length?(t.initRemaining(t.data.remaining),_.find(t.data.buildings,t.selected)||t.select(_.first(t.data.buildings)),e&&t.$nextTick((function(){return t.$modal.modal()}))):t.close()}))},store:function(){var t=this;axios.post(this.storeUrl.replace("__grid__",this.grid.id).replace("__building__",this.selected.id)).then((function(){t.close(),s.$emit("planet-update")}))},destroy:function(){var t=this;axios.delete(this.destroyUrl.replace("__grid__",this.grid.id)).then((function(){t.close(),s.$emit("planet-update")}))},isSelected:function(t){return this.selected.id===t.id},select:function(t){this.selected=t}}}),d=o.extend({props:["url"],data:function(){return{grid:{}}},created:function(){s.$on("demolish-open",this.open)},methods:{open:function(t){this.grid=t,this.$modal.modal()},demolish:function(){var t=this;axios.delete(this.url.replace("__grid__",this.grid.id)).then((function(){t.close(),s.$emit("planet-update")}))}}});var h=n(381),l=n.n(h);function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],i=!0,a=!1,s=void 0;try{for(var r,o=t[Symbol.iterator]();!(i=(r=o.next()).done)&&(n.push(r.value),!e||n.length!==e);i=!0);}catch(t){a=!0,s=t}finally{try{i||null==o.return||o.return()}finally{if(a)throw s}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}const m=function(t){return"(".concat(t,")")},g=function(t){var e=l()(t,"YYYY-MM-DD HH:mm:ss");return e.isValid()?e.fromNow():t},v=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"resource",n=t&&_.has(t,"id")?t.id:t;return!n||"number"!=typeof n&&"string"!=typeof n?"":e+"-"+n},y=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=Math.abs(t);return n>=Math.pow(10,13)?"".concat((t/Math.pow(10,12)).toFixed(e),"t"):n>=Math.pow(10,10)?"".concat((t/Math.pow(10,9)).toFixed(e),"b"):n>=Math.pow(10,7)?"".concat((t/Math.pow(10,6)).toFixed(e),"m"):n>=Math.pow(10,4)?"".concat((t/Math.pow(10,3)).toFixed(e),"k"):Math.round(t)},b=function(t){return"".concat((100*t).toFixed(0),"%")},x=function(t,e){var n=e;n||(n=t);var i=_.isNumber(t)?Math.abs(t):t;return n<0?"-".concat(i):"+".concat(i)},w=function(t){var e=Math.abs(t),n=[e/3600,e%3600/60,e%60],i=p(n=_.map(n,(function(t){return _.padStart(Math.floor(t),2,"0")})),3),a=i[0],s=i[1],r=i[2];return"".concat(a,":").concat(s,":").concat(r)},k=i.default.extend({props:{isEnabled:Boolean,url:{type:String,required:!0}},data:function(){return{page:1,data:{current_page:1,last_page:1,total:0}}},computed:{isEmpty:function(){return 0===this.data.total},hasPrev:function(){return this.data.current_page>1},hasNext:function(){return this.data.current_page<this.data.last_page},dataUrl:function(){return this.url}},watch:{isEnabled:function(){this.page=1,this.fetchData()}},created:function(){var t=this;s.$on("user-updated",(function(){return t.fetchData()}))},methods:{fetchData:function(){var t=this;this.isEnabled&&axios.get(this.dataUrl,{params:{page:this.page}}).then((function(e){t.data=e.data}))},prevPage:function(){this.changePage(this.page-1)},nextPage:function(){this.changePage(this.page+1)},changePage:function(t){this.page!==t&&(t<1||t>this.data.last_page||(this.page=t,this.fetchData()))}}}),j=k.extend({props:["openAfterHidden"],data:function(){return{collapsed:[]}},methods:{isCollapsed:function(t){return _.includes(this.collapsed,t.id)},collapse:function(t){var e=_.indexOf(this.collapsed,t.id);e>-1?this.collapsed.splice(e,1):this.collapsed.push(t.id)},openUser:function(t){this.openAfterHidden((function(){return s.$emit("profile-click",t)}))}}}),T=k.extend({props:["openAfterHidden"],data:function(){return{collapsed:[]}},methods:{isCollapsed:function(t){return _.includes(this.collapsed,t.id)},collapse:function(t){var e=_.indexOf(this.collapsed,t.id);e>-1?this.collapsed.splice(e,1):this.collapsed.push(t.id)},openUser:function(t){this.openAfterHidden((function(){return s.$emit("profile-click",t)}))},sendMessage:function(t){this.openAfterHidden((function(){return s.$emit("message-click",t)}))}}}),U={data:function(){return{selectedTab:""}},methods:{isSelectedTab:function(t){return this.selectedTab===t},selectTab:function(t){this.selectedTab=t}}},M=o.extend({components:{BattleLog:j,CompletionLog:k,MessageLog:T},mixins:[U],data:function(){return{selectedTab:"mission-log"}},created:function(){s.$on("mailbox-click",this.open)},methods:{open:function(){var t=this;this.$nextTick((function(){return t.$modal.modal()}))}}}),S=o.extend({props:["url"],data:function(){return{isSubmitted:!1,errors:{},form:{}}},created:function(){this.form=this.values()},computed:{method:function(){return"post"},parameters:function(){return JSON.parse(JSON.stringify(this.form))}},methods:{hasError:function(t){return _.has(this.errors,t)},values:function(){return{}},error:function(t){return _.first(this.errors[t])},submit:function(){this.isSubmitted||(this.isSubmitted=!0,axios[this.method](this.url,this.parameters).then(this.handleSuccess).catch(this.handleError))},handleSuccess:function(){this.isSubmitted=!1,this.errors={},this.close()},handleError:function(t){this.isSubmitted=!1,422===_.get(t,"response.status")&&(this.errors=_.get(t,"response.data.errors",{}))}}}),P=S.extend({created:function(){s.$on("message-click",this.open)},methods:{open:function(t){var e=this;this.form=this.values(),this.form.recipient=t,this.$nextTick((function(){return e.$modal.modal()}))},values:function(){return{recipient:"",message:""}}}}),E={props:["url"],data:function(){return{data:{incoming:0}}},created:function(){var t=this;s.$on("user-updated",(function(){return t.fetchData()}))},computed:{isEnabled:function(){return this.data.incoming>0}},methods:{fetchData:function(){var t=this;axios.get(this.url).then((function(e){t.data=e.data}))},openRadar:function(){s.$emit("mothership-click","radar")}}},D=r.extend({props:["completion","isCompletable","store"],created:function(){this.initRemaining(this.completion.remaining)},watch:{completion:function(){this.initRemaining(this.completion.remaining)}}}),I={props:["isEnabled","url","storeUrl"],components:{Completion:D},data:function(){return{data:{units:[],expeditions:[]}}},created:function(){var t=this;s.$on("planet-update",(function(){return t.fetchData()}))},computed:{isEmpty:function(){return!this.data.expeditions.length}},watch:{isEnabled:function(){this.fetchData()}},methods:{fetchData:function(){var t=this;this.isEnabled&&axios.get(this.url).then((function(e){t.data=e.data}))},isCompletable:function(t){var e=this;return!_.some(t.units,(function(t){return t.quantity>_.find(e.data.units,{id:t.id}).quantity}))},store:function(t){axios.post(this.storeUrl.replace("__expedition__",t.id))}}},q={props:["isEnabled","url","storeUrl"],components:{Completion:D},data:function(){return{data:{solarion:0,resources:[],missions:[]}}},created:function(){var t=this;s.$on("planet-update",(function(){return t.fetchData()}))},computed:{isEmpty:function(){return!this.data.missions.length}},watch:{isEnabled:function(){this.fetchData()}},methods:{fetchData:function(){var t=this;this.isEnabled&&axios.get(this.url).then((function(e){t.data=e.data}))},isCompletable:function(t){var e=this;return!_.some(t.resources,(function(t){return t.quantity>_.find(e.data.resources,{id:t.id}).quantity}))},store:function(t){axios.post(this.storeUrl.replace("__mission__",t.id))}}},R={props:["isEnabled","url","storeResourceUrl","storeUnitUrl","destroyResourceUrl","destroyUnitUrl"],components:{Research:r.extend({props:["research","isResearchable","store","destroy"],data:function(){return{isResearch:!0}},created:function(){this.initRemaining(this.research.remaining)},computed:{resource:function(){return this.research},unit:function(){return this.research}},watch:{research:function(){this.initRemaining(this.research.remaining)}}})},data:function(){return{energy:0,data:{resource:void 0,units:[]}}},created:function(){var t=this;s.$on("energy-updated",(function(e){t.energy=e})),s.$on("user-updated",(function(){return t.fetchData()}))},computed:{isEmpty:function(){return!this.data.resource&&!this.data.units.length}},watch:{isEnabled:function(){this.fetchData()}},methods:{fetchData:function(){var t=this;this.isEnabled&&axios.get(this.url).then((function(e){t.data=e.data}))},isResearchable:function(t){return this.energy>=t.research_cost},storeResource:function(){axios.post(this.storeResourceUrl)},destroyResource:function(){axios.delete(this.destroyResourceUrl)},storeUnit:function(t){axios.post(this.storeUnitUrl.replace("__unit__",t.id))},destroyUnit:function(t){axios.delete(this.destroyUnitUrl.replace("__unit__",t.id))}}},C=r.extend({props:["movement","canMove","move"],created:function(){this.initRemaining(this.movement.remaining)},watch:{movement:function(){this.initRemaining(this.movement.remaining)}}}),z={methods:{isRouteName:function(t){return!_.isEmpty(this.$route)&&this.$route.name===t}}},A={props:["isEnabled","url","canMove","close"],components:{Movement:C},mixins:[z],data:function(){return{data:{incoming_movements:[]}}},created:function(){var t=this;s.$on("user-update",(function(){return t.fetchData()}))},computed:{isEmpty:function(){return!this.data.incoming_movements.length}},watch:{isEnabled:function(){this.fetchData()}},methods:{fetchData:function(){var t=this;this.isEnabled&&axios.get(this.url).then((function(e){t.data=e.data}))},move:function(t){s.$emit("starmap-move",t.end.x,t.end.y),this.close()}}},N={props:["isEnabled","url","storeUrl","close","planets"],components:{Completion:D},mixins:[z],data:function(){return{selected:void 0,data:{can_store:!0,shields:[]}}},computed:{isEmpty:function(){return!this.data.shields.length}},watch:{isEnabled:function(){this.fetchData()},planets:function(){_.find(this.planets,{id:this.selected})||(this.selected=_.get(_.first(this.planets),"id"))}},methods:{fetchData:function(){var t=this;this.isEnabled&&axios.get(this.url).then((function(e){t.data=e.data}))},store:function(){axios.post(this.storeUrl.replace("__planet__",this.selected)).then(this.fetchData)},move:function(t){s.$emit("starmap-move",t.planet.x,t.planet.y),this.close()}}},B=o.extend({props:["url","storeUrl"],components:{Armory:I,Cargo:q,Laboratory:R,Radar:A,Shield:N},mixins:[U],data:function(){return{selected:void 0,selectedTab:"cargo",data:{capital_id:void 0,capital_change_remaining:0,incoming_capital_movement_count:0,planets:[]}}},created:function(){var t=this;s.$on("mothership-click",this.open),s.$on("user-updated",(function(){return t.fetchData()}))},computed:{canHyperjump:function(){return!this.data.incoming_capital_movement_count&&this.selected!==this.data.capital_id}},methods:{open:function(t){t&&this.selectTab(t),this.fetchData(!0)},fetchData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(e||this.isEnabled)&&axios.get(this.url).then((function(n){t.data=n.data,t.selected=t.data.capital_id,t.initRemaining(t.data.capital_change_remaining),e&&t.$nextTick((function(){return t.$modal.modal()}))}))},store:function(){axios.put(this.storeUrl.replace("__planet__",this.selected))}}}),O={data:function(){return{isMove:!1,quantity:{}}},computed:{hasUnits:function(){var t=this,e=_.pickBy(this.quantity),n=!1;return _.forEach(this.planet.units,(function(i){return!_.has(e,i.id)||(n=e[i.id]>0,n&&e[i.id]<=t.unitQuantity(i))})),n},slowestSupportUnitSpeed:function(){if(this.hasUnits){var t=_.pickBy(this.quantity);return _.get(_.minBy(_.filter(this.planet.units,(function(e){return _.has(t,e.id)})),"speed"),"speed",1)}return 1}},methods:{setTotalUnit:function(t){var e=this.unitQuantity(t);e>0&&this.$set(this.quantity,t.id,e)},unitQuantity:function(t){return(this.isMove?_.get(t,"storage",0):0)+_.get(t,"quantity",0)}}},F={data:function(){return{isMove:!1,quantity:{}}},computed:{canTransport:function(){return this.hasResources&&this.transporterQuantity<=this.unitQuantity(this.transporterUnit)},hasResources:function(){var t=this,e=_.pickBy(this.quantity),n=!1;return _.forEach(this.planet.resources,(function(i){return!_.has(e,i.id)||(n=e[i.id]>0,n&&e[i.id]<=t.resourceQuantity(i))})),n},transporterUnit:function(){var t=this;return _.find(this.planet.units,(function(e){return e.type===t.unitTypes.transporter}))},transporterQuantity:function(){if(!this.hasResources)return 0;var t=_.reduce(_.pickBy(this.quantity),(function(t,e){return t+e}),0);return Math.ceil(t/this.transporterUnit.capacity)}},methods:{setTotalResource:function(t){var e=this.resourceQuantity(t);e>0&&this.$set(this.quantity,t.id,e)},resourceQuantity:function(t){var e=this.isMove?_.get(t,"storage",0):0;return this.planet.resource_id===t.id?e+Math.floor(this.mined):e+_.get(t,"quantity",0)}}},Y=o.extend({props:["types","unitTypes","urls"],mixins:[O,F],data:function(){return{isMove:!0,type:void 0,mined:0,selected:{id:void 0,travel_time:0},planet:{id:void 0,resource_id:void 0,resources:[],units:[]}}},created:function(){var t=this;s.$on("move-click",this.open),s.$on("planet-updated",(function(e){t.planet=e})),s.$on("resource-updated",(function(e){t.mined=e}))},computed:{isScoutType:function(){return this.type===this.types.scout},isAttackType:function(){return this.type===this.types.attack},isOccupyType:function(){return this.type===this.types.occupy},isSupportType:function(){return this.type===this.types.support},isTransportType:function(){return this.type===this.types.transport},canScout:function(){return _.has(this.quantity,this.scoutUnit.id)&&this.quantity[this.scoutUnit.id]>0&&this.quantity[this.scoutUnit.id]<=this.unitQuantity(this.scoutUnit)},canOccupy:function(){return this.unitQuantity(this.settlerUnit)>0},hasFighterUnits:function(){var t=this,e=_.pickBy(this.quantity),n=!1;return _.forEach(this.fighterUnits,(function(i){return!_.has(e,i.id)||(n=e[i.id]>0,n&&e[i.id]<=t.unitQuantity(i))})),n},scoutUnit:function(){var t=this;return _.find(this.planet.units,(function(e){return e.type===t.unitTypes.scout}))},settlerUnit:function(){var t=this;return _.find(this.planet.units,(function(e){return e.type===t.unitTypes.settler}))},fighterUnits:function(){var t=this;return _.filter(this.planet.units,(function(e){return e.type===t.unitTypes.fighter||e.type===t.unitTypes.heavyFighter}))},travelTime:function(){return Math.round(this.selected.travel_time/this.slowestUnitSpeed)},slowestUnitSpeed:function(){if(this.isScoutType)return this.scoutUnit.speed;if(this.isOccupyType)return this.settlerUnit.speed;if(this.isTransportType)return this.transporterUnit.speed;if(this.isSupportType)return this.slowestSupportUnitSpeed;if(this.isAttackType&&this.hasFighterUnits){var t=_.pickBy(this.quantity);return _.get(_.minBy(_.filter(this.fighterUnits,(function(e){return _.has(t,e.id)})),"speed"),"speed",1)}return 1}},methods:{open:function(t,e){var n=this;this.type=t,this.selected=e,this.quantity={},this.$nextTick((function(){return n.$modal.modal()}))},scout:function(){axios.post(this.urls.scout.replace("__planet__",this.selected.id),{quantity:this.quantity[this.scoutUnit.id]}).then(this.close)},attack:function(){axios.post(this.urls.attack.replace("__planet__",this.selected.id),{quantity:this.quantity}).then(this.close)},occupy:function(){axios.post(this.urls.occupy.replace("__planet__",this.selected.id)).then(this.close)},support:function(){axios.post(this.urls.support.replace("__planet__",this.selected.id),{quantity:this.quantity}).then(this.close)},transport:function(){axios.post(this.urls.transport.replace("__planet__",this.selected.id),{quantity:this.quantity}).then(this.close)}}}),H={methods:{prev:function(){s.$emit("prev-planet")},next:function(){s.$emit("next-planet")},upgradeAll:function(){s.$emit("upgrade-all-open")}}},J=o.extend({props:["url","planetImageUrl"],data:function(){return{geoJsonPoint:{properties:{status:""},geometry:{coordinates:[]}},planet:{id:void 0},data:{resource_id:null,username:""}}},created:function(){var t=this;s.$on("planet-click",this.open),s.$on("planet-updated",(function(e){t.planet=e}))},computed:{isCurrent:function(){return this.properties.id===this.planet.id},isFriendly:function(){return"friendly"===this.properties.status},properties:function(){return this.geoJsonPoint.properties},geometry:function(){return this.geoJsonPoint.geometry},planetPreviewUrl:function(){return this.data&&this.data.resource_id&&this.planetImageUrl?this.planetImageUrl.replace("__resource__",this.data.resource_id):null}},methods:{open:function(t){this.geoJsonPoint=t,this.fetchData()},fetchData:function(){var t=this;axios.get(this.url.replace("__planet__",this.properties.id)).then((function(e){t.data=e.data,t.$nextTick((function(){return t.$modal.modal()}))}))},openUser:function(){var t=this;this.openAfterHidden((function(){return s.$emit("profile-click",t.data.username)}))},changePlanet:function(){s.$emit("change-planet",this.properties.id)},jumpToSurface:function(){this.$modal.modal("hide"),this.$nextTick((function(){$(".modal-backdrop").remove(),$("body").removeClass("modal-open").css({overflow:"","padding-right":""})})),this.$router.push({name:"home"}).catch((function(t){t&&"NavigationDuplicated"===t.name||(window.location.href="/")}))},openMove:function(t){var e=this;this.openAfterHidden((function(){return s.$emit("move-click",t,_.assignIn({},e.properties,e.data))}))}}}),X={props:["url"],data:function(){return{isSubscribed:!1,energy:0,energyInterval:void 0,data:{id:void 0,username:"",production_rate:0,experience:0,level:1,level_experience:0,next_level_experience:0,notification_count:0}}},created:function(){this.fetchData()},computed:{hasUnread:function(){return this.data.notification_count>0},experienceLabel:function(){return"".concat(this.data.experience," / ").concat(this.data.next_level_experience)},experienceProgress:function(){return"".concat((this.data.experience-this.data.level_experience)/(this.data.next_level_experience-this.data.level_experience)*100,"%")},energyValue:function(){return Math.round(this.energy)}},watch:{energy:function(){s.$emit("energy-updated",this.energy)}},methods:{fetchData:function(){var t=this;s.$emit("user-update"),this.unsubscribe(),axios.get(this.url).then((function(e){t.data=e.data,t.initEnergy(),t.subscribe(),s.$emit("user-updated",t.data)}))},initEnergy:function(){var t=this;this.clearEnergy(),this.energy=this.data.energy,this.data.production_rate&&(this.energyInterval=setInterval((function(){t.energy+=t.data.production_rate/3600}),1e3))},clearEnergy:function(){this.energyInterval&&(this.energyInterval=clearInterval(this.energyInterval))},subscribe:function(){this.isSubscribed||(Echo.private("user.".concat(this.data.id)).listen(".updated",this.fetchData).notification(this.fetchData),this.isSubscribed=!0)},unsubscribe:function(){this.isSubscribed&&(Echo.leave("user.".concat(this.data.id)),this.isSubscribed=!1)},openUser:function(){s.$emit("profile-click",this.data.username)},openMailbox:function(){s.$emit("mailbox-click")},openSetting:function(){s.$emit("setting-click")}}};const Q={bind:function(t,e){var n={container:"body"};e.value&&(n=_.extend({},n,e.value)),$(t).popover(n)},unbind:function(t){$(t).popover("dispose")},update:function(t,e){e.value.title!==e.oldValue.title&&($(t).data("bs.popover").config.title=e.value.title),e.value.content!==e.oldValue.content&&($(t).data("bs.popover").config.content=e.value.content)}},Z=k.extend({props:["username","canMove","close"],computed:{dataUrl:function(){return this.url.replace("__user__",this.username)}},methods:{move:function(t){s.$emit("starmap-move",t.x,t.y),this.close()}}}),W=o.extend({props:["url","blockUrl","canMove","translations"],components:{PlanetList:Z},mixins:[z],data:function(){return{isBlocked:!1,username:"",data:{is_blocked:!1,created_at:""}}},created:function(){s.$on("profile-click",this.open)},computed:{joined:function(){return this.translations.joined.replace("__datetime__",g(this.data.created_at))}},methods:{open:function(t){this.username=t,this.fetchData()},fetchData:function(){var t=this;axios.get(this.url.replace("__user__",this.username)).then((function(e){t.data=e.data,t.isBlocked=t.data.is_blocked,t.$nextTick((function(){return t.$modal.modal()}))}))},sendMessage:function(){var t=this;this.openAfterHidden((function(){return s.$emit("message-click",t.username)}))},toggleBlock:function(){this.isBlocked=!this.isBlocked,axios.put(this.blockUrl.replace("__user__",this.username))}}}),G=S.extend({props:["settings"],computed:{method:function(){return"put"}},methods:{values:function(){return{title:this.settings.title,description:this.settings.description,author:this.settings.author}},handleSuccess:function(){window.location.reload()}}}),V=S.extend({components:{DeveloperSetting:G},mixins:[U],data:function(){return{selectedTab:"profile",user:{email:"",is_notification_enabled:!0}}},created:function(){var t=this;s.$on("setting-click",this.open),s.$on("user-updated",(function(e){t.user=e}))},computed:{method:function(){return"put"}},methods:{open:function(){var t=this;this.form=this.values(),this.$nextTick((function(){return t.$modal.modal()}))},values:function(){return{email:this.user.email,password:"",password_confirmation:"",is_notification_enabled:this.user.is_notification_enabled}}}});var K=n(4772);const tt={props:["planetUrl","planetNameUrl","userCurrentUrl"],mixins:[z],data:function(){return{perfectScrollbar:void 0,isActive:!1,isEditActive:!1,isSubscribed:!1,selected:void 0,name:"",usedCapacity:0,resource:0,resourceInterval:void 0,data:{id:void 0,resource_id:void 0,user_id:void 0,capacity:0,supply:0,solarion:0,mining_rate:0,used_capacity:0,used_supply:0,used_training_supply:0,display_name:"",planets:[],resources:[],units:[]}}},created:function(){var t=this;this.fetchData(),s.$on("prev-planet",this.prevPlanet),s.$on("next-planet",this.nextPlanet),s.$on("change-planet",(function(e){t.selected=e})),s.$on("planet-data-request",(function(){t.data&&t.data.id&&(s.$emit("planet-updated",t.data),s._lastPlanetData=t.data)})),this._sidebarFetching=!1,s.$on("planet-update",(function(){t._sidebarFetching||t.fetchData()}))},mounted:function(){this.initPerfectScrollbar()},watch:{$route:function(){this.fetchData()},selected:function(){this.changePlanet()},resource:function(){s.$emit("resource-updated",this.resource)}},computed:{isResourceFull:function(){return this.data.capacity===this.usedCapacity},isUnitFull:function(){return this.data.supply===this.data.used_supply},selectedIndex:function(){return _.findIndex(this.data.planets,{id:this.selected})},resourceLabel:function(){return"".concat(Math.round(this.usedCapacity)," / ").concat(this.data.capacity)},resourceProgress:function(){return"".concat(Math.min(100,this.usedCapacity/this.data.capacity*100),"%")},unitLabel:function(){return"".concat(this.data.used_supply+this.data.used_training_supply," / ").concat(this.data.supply)},unitProgress:function(){return"".concat(this.data.used_supply/this.data.supply*100,"%")},unitTrainingProgress:function(){return"".concat(this.data.used_training_supply/this.data.supply*100,"%")}},methods:{fetchData:function(){var t=this;this._sidebarFetching||(this._sidebarFetching=!0,s.$emit("planet-update"),this.unsubscribe(),axios.get(this.planetUrl).then((function(e){t._sidebarFetching=!1,t.data=e.data,t.selected=t.data.id,t.initName(),t.initResource(),t.subscribe(),s.$emit("planet-updated",t.data),s._lastPlanetData=t.data})).catch((function(){t._sidebarFetching=!1})))},renamePlanet:function(){this.name===this.data.display_name?this.isEditActive=!1:this.name||this.data.name!==this.data.display_name?axios.put(this.planetNameUrl,{name:this.name}):this.initName()},prevPlanet:function(){var t=this.selectedIndex-1;t<0&&(t=this.data.planets.length-1),this.changePlanetByIndex(t)},nextPlanet:function(){var t=this.selectedIndex+1;t===this.data.planets.length&&(t=0),this.changePlanetByIndex(t)},changePlanet:function(){this.selected!==this.data.id&&axios.put(this.userCurrentUrl.replace("__planet__",this.selected))},changePlanetByIndex:function(t){_.isUndefined(this.data.planets[t])||(this.selected=_.get(this.data.planets[t],"id"))},initName:function(){this.isEditActive=!1,this.name=this.data.display_name},initResource:function(){var t=this;this.clearResource(),this.usedCapacity=this.data.used_capacity,this.resource=_.get(_.find(this.data.resources,{id:this.data.resource_id}),"quantity",0),this.data.mining_rate&&this.data.capacity!==this.usedCapacity&&(this.resourceInterval=setInterval((function(){var e=Math.min(t.data.capacity-t.usedCapacity,t.data.mining_rate/3600);t.resource+=e,t.usedCapacity+=e,t.data.capacity===t.usedCapacity&&t.clearResource()}),1e3))},clearResource:function(){this.resourceInterval&&(this.resourceInterval=clearInterval(this.resourceInterval))},initPerfectScrollbar:function(){this.perfectScrollbar=new K.default(this.$refs.scrollbar)},updatePerfectScrollbar:function(){this.perfectScrollbar.update()},subscribe:function(){this.isSubscribed||(Echo.private("planet.".concat(this.data.id)).listen(".updated",this.fetchData),s.$on("user-update",this.fetchData),this.isSubscribed=!0)},unsubscribe:function(){this.isSubscribed&&(Echo.leave("planet.".concat(this.data.id)),s.$off("user-update",this.fetchData),this.isSubscribed=!1)},toggle:function(){this.isActive=!this.isActive,this.isActive&&this.updatePerfectScrollbar()},toggleEdit:function(){var t=this;this.isEditActive=!this.isEditActive,this.isEditActive&&this.$nextTick((function(){return t.$refs.name.focus()}))},resourceQuantity:function(t){return t.id===this.data.resource_id?this.resource:t.quantity},resourceValue:function(t){return Math.round(this.resourceQuantity(t))},openMothership:function(){s.$emit("mothership-click")},openTrophy:function(){s.$emit("trophy-click")}}},et=o.extend({props:["url","bookmarkStoreUrl"],data:function(){return{geoJsonPoint:{properties:{},geometry:{coordinates:[]}},data:{is_bookmarked:!1,has_expedition:!1}}},created:function(){s.$on("star-click",this.open)},computed:{properties:function(){return this.geoJsonPoint.properties},geometry:function(){return this.geoJsonPoint.geometry}},methods:{open:function(t){this.geoJsonPoint=t,this.fetchData()},fetchData:function(){var t=this;axios.get(this.url.replace("__star__",this.properties.id)).then((function(e){t.data=e.data,t.$nextTick((function(){return t.$modal.modal()}))}))},bookmark:function(){this.data.is_bookmarked=!0,axios.post(this.bookmarkStoreUrl.replace("__star__",this.properties.id))},showExpedition:function(){this.openAfterHidden((function(){return s.$emit("mothership-click","armory")}))}}});const nt={props:{size:{type:Number,required:!0},maxZoom:{type:Number,required:!0},geoJsonUrl:{type:String,required:!0},tileUrl:{type:String,required:!0},imagePath:{type:String,required:!0},zoomInTitle:{type:String,required:!0},zoomOutTitle:{type:String,required:!0},bookmarkTitle:{type:String,required:!0}},data:function(){return{geoJsonLayer:void 0,map:void 0,zoom:0,dataError:"",planet:{id:void 0,x:0,y:0}}},created:function(){this.zoom=Math.ceil(Math.log(this.size/256)/Math.log(2))},mounted:function(){var t=this;s.$on("planet-updated",this.planetUpdated),s.$on("starmap-move",this.starmapMove),this.$nextTick((function(){t.map&&t.map.invalidateSize(!0)}))},beforeDestroy:function(){s.$off("planet-updated",this.planetUpdated),s.$off("starmap-move",this.starmapMove),this.destoryLeaflet()},methods:{planetUpdated:function(t){var e=t.id===this.planet.id;this.planet=t,this.map?e?this.refreshGeoJson():this.map.setView(this.center(),this.maxZoom):this.initLeaflet()},starmapMove:function(t,e){this.map.setView(this.unproject(t,e),this.maxZoom)},initLeaflet:function(){var t=this;L.Icon.Default.imagePath="".concat(this.imagePath,"/"),this.map=L.map(this.$el,{attributionControl:!1,boxZoom:!1,crs:L.CRS.Simple,minZoom:0,maxZoom:this.maxZoom,zoomControl:!1}),this.map.setView(this.center(),this.maxZoom),L.tileLayer(this.tileUrl,{noWrap:!0,bounds:L.latLngBounds(this.southWest(),this.northEast())}).addTo(this.map);var e=function(e){return t.map.unproject([e[0],e[1]],t.maxZoom)};this.geoJsonLayer=L.geoJson(null,{coordsToLatLng:e,pointToLayer:function(n,i){return n.properties.is_movement?t.movementMarker(i,e(n.properties.end),n):t.objectMarker(i,n)},style:function(e){return"LineString"===e.geometry.type?{className:"leaflet-movement ".concat(t.movementClassName(e))}:{}}}),this.geoJsonLayer.addTo(this.map),this._pendingRefresh=null,this.map.on("moveend",(function(){return t.refreshGeoJson()})),this.zoomControl().addTo(this.map),this.bookmarkControl().addTo(this.map),this._preventTouch=function(t){return t.preventDefault()},this._preventWheel=function(t){return t.preventDefault()},this.$el.addEventListener("touchmove",this._preventTouch,{passive:!1}),this.$el.addEventListener("wheel",this._preventWheel,{passive:!1}),window.__starmap=this.map,this.$nextTick((function(){requestAnimationFrame((function(){t.map.invalidateSize(!0)}))})),this.refreshGeoJson()},destoryLeaflet:function(){this.map&&(this._preventTouch&&(this.$el.removeEventListener("touchmove",this._preventTouch,{passive:!1}),this._preventTouch=null),this._preventWheel&&(this.$el.removeEventListener("wheel",this._preventWheel,{passive:!1}),this._preventWheel=null),this.map.remove(),this.map=void 0,window.__starmap=void 0)},refreshGeoJson:function(){var t=this,e=this.geoJson();this._pendingRefresh&&(this._pendingRefresh.cancelled=!0);var n={cancelled:!1};this._pendingRefresh=n,axios.get(e).then((function(e){n.cancelled||(t.dataError="",t.geoJsonLayer.clearLayers(),e.data&&e.data.features&&e.data.features.length&&t.geoJsonLayer.addData(e.data))})).catch((function(e){console.error("[StarMap] GeoJSON fetch failed",e),t.dataError="Map data could not be loaded."}))},geoJson:function(){var t=this.map.getPixelBounds(),e=this.multiplier();return this.geoJsonUrl.replace("__zoom__",this.map.getZoom()).replace("__bounds__",[t.min.x*e,t.min.y*e,t.max.x*e,t.max.y*e].join(","))},center:function(){return this.unproject(this.planet.x,this.planet.y)},southWest:function(){return this.unproject(0,0)},northEast:function(){return this.unproject(this.size,this.size)},unproject:function(t,e){return this.map.unproject([t,e],this.zoom)},multiplier:function(){return Math.pow(2,this.maxZoom-this.map.getZoom())},zoomControl:function(){return L.control.zoom({zoomInTitle:this.zoomInTitle,zoomOutTitle:this.zoomOutTitle})},bookmarkControl:function(){return new(L.Control.extend({options:{position:"topleft",bookmarkTitle:this.bookmarkTitle,bookmarkIconClass:"fas fa-star"},onAdd:function(){var t=L.DomUtil.create("div","leaflet-bar leaflet-control leaflet-control-bookmark"),e=L.DomUtil.create("a","leaflet-control-bookmark",t);return e.href="#",e.title=this.options.bookmarkTitle,e.onclick=function(t){t.preventDefault(),s.$emit("bookmark-click")},L.DomUtil.create("i",this.options.bookmarkIconClass,e),t}}))},objectMarker:function(t,e){var n=(e.properties.size+16)/this.multiplier(),i=e.properties,a="leaflet-icon-object";"planet"===i.type?a+=" leaflet-planet leaflet-planet-".concat(i.resource_id||1," ").concat(i.status):"star"===i.type&&(a+=" leaflet-star");var r={className:a,iconSize:[n,n]};this.map.getZoom()>=8&&(r.html="<span>".concat(i.name,"</span>"));var o=L.marker(t,{title:e.properties.name,icon:L.divIcon(r)});return o.on("click",(function(){return s.$emit("".concat(e.properties.type,"-click"),e)})),o},movementMarker:function(t,e,n){L.MovementMarker=L.Marker.extend({options:{end:e,interval:n.properties.interval},onAdd:function(t){var e=this;L.Marker.prototype.onAdd.call(this,t),this._icon&&(this._icon.style[L.DomUtil.TRANSITION]="all ".concat(this.options.interval-1,"s linear")),this._shadow&&(this._shadow.style[L.DomUtil.TRANSITION]="all ".concat(this.options.interval-1,"s linear")),setTimeout((function(){return e.setLatLng(e.options.end)}),1e3)}});var i=32/this.multiplier(),a={className:"leaflet-icon-movement ".concat(this.movementClassName(n)," size-").concat(i),iconSize:[i,i]};if(this.map.getZoom()>=8){var s=Math.atan2(e.lng-t.lng,e.lat-t.lat),r=360*(s>0?s:2*Math.PI+s)/(2*Math.PI)-45;a.html='<i class="fas fa-rocket" style="'.concat(L.DomUtil.TRANSFORM,": translateX(-50%) translateY(-50%) rotate(").concat(r,'deg)"></i>')}return new L.MovementMarker(t,{icon:L.divIcon(a)})},movementClassName:function(t){return"expedition"===t.properties.type?t.properties.type:t.properties.type<3?"".concat(t.properties.status,"-attack"):t.properties.status}}};var it=n(1900);const at=(0,it.Z)(nt,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"starmap"},[t.dataError?n("div",{staticClass:"starmap-error-overlay"},[t._v("\n        "+t._s(t.dataError)+"\n    ")]):t._e()])}),[],!1,null,null,null).exports;var st=n(7757),rt=n.n(st);function ot(t,e,n,i,a,s,r){try{var o=t[s](r),c=o.value}catch(t){return void n(t)}o.done?e(c):Promise.resolve(c).then(i,a)}var ct={plain:{x:0,y:0,w:320,h:200},resources:{1:{x:320,y:0,w:320,h:200},2:{x:640,y:0,w:320,h:200},3:{x:960,y:0,w:320,h:200},4:{x:1280,y:0,w:320,h:200},5:{x:1600,y:0,w:320,h:200},6:{x:0,y:200,w:320,h:200},7:{x:320,y:200,w:320,h:200}},buildings:{1:{x:640,y:200,w:320,h:200},2:{1:{x:960,y:200,w:320,h:200},2:{x:1280,y:200,w:320,h:200},3:{x:1600,y:200,w:320,h:200},4:{x:0,y:400,w:320,h:200},5:{x:320,y:400,w:320,h:200},6:{x:640,y:400,w:320,h:200},7:{x:960,y:400,w:320,h:200}},3:{x:1280,y:400,w:320,h:200},4:{x:1600,y:400,w:320,h:200},5:{x:0,y:600,w:320,h:200},6:{x:320,y:600,w:320,h:200},7:{x:640,y:600,w:320,h:200},8:{x:960,y:600,w:320,h:200},9:{x:1280,y:600,w:320,h:200},10:{x:1600,y:600,w:320,h:200}},constructions:{1:{x:0,y:800,w:320,h:200},2:{x:320,y:800,w:320,h:200},3:{x:640,y:800,w:320,h:200},4:{x:960,y:800,w:320,h:200},5:{x:1280,y:800,w:320,h:200},6:{x:1600,y:800,w:320,h:200},7:{x:0,y:1e3,w:320,h:200},8:{x:320,y:1e3,w:320,h:200},9:{x:640,y:1e3,w:320,h:200},10:{x:960,y:1e3,w:320,h:200}}},ut=320,dt=200,ht=1920,lt=1080;function pt(t,e){return 160*(t-e+4)+160}function ft(t,e){return 80*(t+e)+120}function mt(t){return new Promise((function(e,n){var i=new Image;i.crossOrigin="anonymous",i.onload=function(){e(i)},i.onerror=function(){n(new Error("Load failed: "+t))},i.src=t}))}const gt={props:{width:{type:Number,required:!0},height:{type:Number,required:!0},backgroundTexture:{type:String,required:!0},gridTextureAtlas:{type:String,required:!0}},data:function(){return{ready:!1,errorMessage:"",planet:{resource_id:void 0,grids:[]},_panX:0,_panY:0,_dragStartX:0,_dragStartY:0,_dragging:!1,_dragged:0}},mounted:function(){var t=this;this._destroyed=!1,this._hasPlanetData=!1,this._tf=null,s.$on("planet-updated",this.onPlanetData),s.$on("planet-update",this.onPlanetUpdateRequest),s.$emit("planet-data-request"),this.$nextTick((function(){t._destroyed||t._hasPlanetData||t.fetchPlanet()})),this._retryTimer=setTimeout((function(){t._destroyed||t._hasPlanetData||t.fetchPlanet()}),3e3),"undefined"!=typeof ResizeObserver&&this.$refs.viewport&&(this._ro=new ResizeObserver((function(){return t.onContainerResize()})),this._ro.observe(this.$refs.viewport)),window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onOrientationChange)},beforeDestroy:function(){this._destroyed=!0,s.$off("planet-updated",this.onPlanetData),s.$off("planet-update",this.onPlanetUpdateRequest),clearTimeout(this._retryTimer),this._timerInterval&&clearInterval(this._timerInterval),this._syncInterval&&clearInterval(this._syncInterval),this._ro&&this._ro.disconnect(),window.removeEventListener("resize",this.onWindowResize),window.removeEventListener("orientationchange",this.onOrientationChange)},methods:{toLocalPath:function(t){if(!t)return t;try{return new URL(t,location.origin).pathname}catch(e){return t.replace(/^https?:\/\/[^\/]+/,"")}},bgUrl:function(){return this.toLocalPath(this.backgroundTexture.replace("__resource__",this.planet.resource_id))},atlasUrl:function(){return this.toLocalPath(this.gridTextureAtlas)},fetchPlanet:function(){var t=this;this._fetchInFlight||(this._fetchInFlight=!0,axios.get("/api/planet").then((function(e){t._fetchInFlight=!1,!t._destroyed&&e.data&&e.data.id&&t.onPlanetData(e.data)})).catch((function(){t._fetchInFlight=!1,t._destroyed||t._hasPlanetData||(t.errorMessage="Planet data could not be loaded.")})))},onPlanetUpdateRequest:function(){this._destroyed||this.fetchPlanet()},onPlanetData:function(t){if(!this._destroyed&&t&&t.resource_id){if(this.planet=t,this.normalizeGridCoords(),this._hasPlanetData)return this.draw(),void this.startTimers();this._hasPlanetData=!0,this.initSurface()}},normalizeGridCoords:function(){var t=this.planet.grids;if(!t||!t.length)return this._gmx=0,void(this._gmy=0);for(var e=t[0].x,n=t[0].y,i=1;i<t.length;i++)t[i].x<e&&(e=t[i].x),t[i].y<n&&(n=t[i].y);this._gmx=e,this._gmy=n},initSurface:function(){var t,e=this;return(t=rt().mark((function t(){var n;return rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.errorMessage="",t.prev=1,t.next=4,Promise.all([mt(e.bgUrl()),mt(e.atlasUrl())]);case 4:if(n=t.sent,!e._destroyed){t.next=7;break}return t.abrupt("return");case 7:e._bgImg=n[0],e._atlasImg=n[1],e.ready=!0,e.$nextTick((function(){e.refit()})),e.startTimers(),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(1),e.errorMessage="Surface could not be loaded.",e.ready=!0;case 18:case"end":return t.stop()}}),t,null,[[1,14]])})),function(){var e=this,n=arguments;return new Promise((function(i,a){var s=t.apply(e,n);function r(t){ot(s,i,a,r,o,"next",t)}function o(t){ot(s,i,a,r,o,"throw",t)}r(void 0)}))})()},refit:function(){var t=this.$refs.viewport,e=this.$refs.canvas;if(t&&e){var n=t.clientWidth,i=t.clientHeight;if(!(n<10||i<10)){var a=n>=i?"landscape":"portrait",s=Math.min(window.devicePixelRatio||1,2);e.style.width=n+"px",e.style.height=i+"px",e.width=Math.round(n*s),e.height=Math.round(i*s),this._tf=function(t,e,n){var i,a,s,r;i=Math.max(t/ht,e/lt),a=(t-ht*i)/2,s=(e-lt*i)/2,r="portrait"===n;var o=ht*i,c=lt*i,u=Math.max(0,-a),d=Math.min(0,t-o-a),h=Math.max(0,-s),l=Math.min(0,e-c-s);return d>=u&&(d=0,u=0),l>=h&&(l=0,h=0),{scale:i,tx:a,ty:s,pannable:r,minPanX:d,maxPanX:u,minPanY:l,maxPanY:h}}(n,i,a),this._tf.dpr=s,this._tf.cw=n,this._tf.ch=i,this._panX=0,this._panY=0,this.draw()}}},draw:function(){var t=this.$refs.canvas;if(t&&this._bgImg&&this._tf){var e=t.getContext("2d"),n=this._tf,i=n.dpr;e.setTransform(i,0,0,i,0,0),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";var a=n.cw,s=n.ch,r=n.scale,o=n.tx+this._panX,c=n.ty+this._panY;e.fillStyle="#0b0e14",e.fillRect(0,0,a,s),e.drawImage(this._bgImg,Math.round(o),Math.round(c),Math.round(ht*r),Math.round(lt*r));var u=this.planet.grids;if(u&&u.length&&this._atlasImg){if(this._sortedGrids&&this._sortedGrids.length===u.length)for(var d=0;d<u.length;d++)this._sortedGrids[d]=u[d];else this._sortedGrids=u.slice();var h=this._gmx,l=this._gmy;this._sortedGrids.sort((function(t,e){return t.x-h+(t.y-l)-(e.x-h+(e.y-l))}));for(var p=0;p<this._sortedGrids.length;p++)this.drawSlot(e,this._sortedGrids[p],r,o,c);-1!==location.search.indexOf("debug=1")&&this.drawDebug(e,u,r,o,c),e.setTransform(1,0,0,1,0,0)}}},drawSlot:function(t,e,n,i,a){var s=e.x-this._gmx,r=e.y-this._gmy,o=Math.round(pt(s,r)*n+i),c=Math.round(ft(s,r)*n+a),u=Math.round(ut*n),d=Math.round(dt*n),h=function(t,e){try{if(t.construction)return ct.constructions[t.construction.building_id]||null;if(t.building_id&&t.level&&t.level>0){var n=ct.buildings[t.building_id];return n?n.w?n:n[e]||n[1]||null:null}if(1===t.type)return ct.resources[e]||null}catch(t){}return null}(e,this.planet.resource_id);if(h){if(t.drawImage(this._atlasImg,ct.plain.x,ct.plain.y,ct.plain.w,ct.plain.h,o,c,u,d),t.drawImage(this._atlasImg,h.x,h.y,h.w,h.h,o,c,u,d),e.building_id&&e.level&&e.level>0){var l=Math.max(10,Math.round(14*n));t.font=l+'px "Exo 2",sans-serif',t.textAlign="center",t.strokeStyle="#0e141c",t.lineWidth=3,t.fillStyle="#fff";var p=o+u/2,f=c+d-Math.round(8*n);t.strokeText(e.level,p,f),t.fillText(e.level,p,f)}var m=null,g="#fff";if(e.construction?m=e.construction.remaining:e.upgrade?m=e.upgrade.remaining:e.training&&(m=e.training.remaining,g="#ebb237"),m&&m>0){var _=Math.max(10,Math.round(14*n));t.font=_+'px "Exo 2",sans-serif',t.textAlign="center",t.strokeStyle="#0e141c",t.lineWidth=3,t.fillStyle=g;var v=w(m);t.strokeText(v,o+u/2,c+d/2+Math.round(_/3)),t.fillText(v,o+u/2,c+d/2+Math.round(_/3))}}},drawDebug:function(t,e,n,i,a){t.lineWidth=1,t.font="10px monospace",t.textAlign="center";for(var s=0;s<e.length;s++){var r=e[s],o=r.x-this._gmx,c=r.y-this._gmy,u=Math.round(pt(o,c)*n+i),d=Math.round(ft(o,c)*n+a),h=Math.round(ut*n),l=Math.round(dt*n);t.strokeStyle=r.building_id?"lime":"rgba(255,0,0,0.4)",t.strokeRect(u,d,h,l),t.fillStyle=r.building_id?"lime":"red",t.fillText(o+","+c+" t"+r.type+" b"+(r.building_id||"-")+" L"+(r.level||0),u+h/2,d+l/2)}},startTimers:function(){var t=this;this._timerInterval&&clearInterval(this._timerInterval),this._syncInterval&&clearInterval(this._syncInterval);var e=this.planet.grids;if(e){for(var n=!1,i=0;i<e.length;i++){var a=e[i];if(a.construction&&a.construction.remaining>0||a.upgrade&&a.upgrade.remaining>0||a.training&&a.training.remaining>0){n=!0;break}}n&&(this._timerInterval=setInterval((function(){if(t._destroyed)clearInterval(t._timerInterval);else{for(var n=!1,i=0;i<e.length;i++){var a=e[i];a.construction&&a.construction.remaining>0&&(a.construction.remaining--,n=!0),a.upgrade&&a.upgrade.remaining>0&&(a.upgrade.remaining--,n=!0),a.training&&a.training.remaining>0&&(a.training.remaining--,n=!0)}t.draw(),n||(clearInterval(t._timerInterval),t._timerInterval=null,t.fetchPlanet())}}),1e3)),this._syncInterval=setInterval((function(){t._destroyed?clearInterval(t._syncInterval):t.fetchPlanet()}),15e3)}},screenToDesign:function(t,e){var n=this.$refs.canvas.getBoundingClientRect(),i=this._tf;return{x:(t-n.left-i.tx-this._panX)/i.scale,y:(e-n.top-i.ty-this._panY)/i.scale}},findSlotAt:function(t,e){var n,i,a=this.planet.grids;if(!a)return null;for(var s=a.length-1;s>=0;s--){var r=a[s].x-this._gmx,o=a[s].y-this._gmy,c=t-pt(r,o),u=e-ft(r,o);if(c>=0&&c<=ut&&u>=0&&u<=dt&&(n=void 0,i=void 0,n=c-160,i=u-120,Math.abs(n)/160+Math.abs(i)/80<=1))return a[s]}return null},onPointer:function(t){this._dragging=!0,this._dragged=0,this._dragStartX=t.clientX-this._panX,this._dragStartY=t.clientY-this._panY},onPointerMove:function(t){if(this._dragging&&this._tf)if(this._tf.pannable){var e=t.clientX-this._dragStartX,n=t.clientY-this._dragStartY;this._dragged+=Math.abs(e-this._panX)+Math.abs(n-this._panY),this._panX=Math.max(this._tf.minPanX,Math.min(this._tf.maxPanX,e)),this._panY=Math.max(this._tf.minPanY,Math.min(this._tf.maxPanY,n)),this.draw()}else this._dragged+=Math.abs(t.movementX||0)+Math.abs(t.movementY||0)},onPointerUp:function(t){if(this._dragging&&(this._dragging=!1,this._dragged<10)){var e=this.screenToDesign(t.clientX,t.clientY),n=this.findSlotAt(e.x,e.y);n&&s.$emit(n.building_id?"building-click":"grid-click",n)}},onContainerResize:function(){!this._destroyed&&this._bgImg&&this.refit()},onWindowResize:function(){var t=this;this._resizeTimer||(this._resizeTimer=setTimeout((function(){t._resizeTimer=null,!t._destroyed&&t._bgImg&&t.refit()}),100))},onOrientationChange:function(){var t=this;setTimeout((function(){!t._destroyed&&t._bgImg&&t.refit()}),250)}}};const _t=(0,it.Z)(gt,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"viewport",staticClass:"surface-viewport"},[n("canvas",{ref:"canvas",staticClass:"surface",on:{pointerdown:t.onPointer,pointermove:t.onPointerMove,pointerup:t.onPointerUp,pointercancel:t.onPointerUp}}),t._v(" "),t.ready?t._e():n("div",{staticClass:"surface-loading"},[n("div",{staticClass:"surface-spinner"})]),t._v(" "),t.errorMessage?n("p",{staticClass:"surface-error-text"},[t._v(t._s(t.errorMessage))]):t._e()])}),[],!1,null,null,null).exports,vt=k.extend({props:["openAfterHidden"],methods:{openUser:function(t){this.openAfterHidden((function(){return s.$emit("profile-click",t)}))},rank:function(t){return this.data.from+t}}}),yt=o.extend({components:{Leaderboard:vt},mixins:[U],data:function(){return{selectedTab:"pve"}},created:function(){s.$on("trophy-click",this.open)},methods:{open:function(){var t=this;this.$nextTick((function(){return t.$modal.modal()}))}}}),bt=r.extend({props:["type","building"],data:function(){return{isEnabled:!1}},created:function(){var t=this;s.$on("modal-show",(function(){t.isEnabled=t.type===t.building.type})),s.$on("modal-hidden",(function(){t.isEnabled=!1}))}}),xt=bt.extend({props:["grid","url","storeUrl"],data:function(){return{isResearch:!1,mined:0,quantity:"",planet:{resource_id:void 0,resources:[]},selected:{id:void 0,efficiency:0},data:{resources:[]}}},created:function(){var t=this;s.$on("resource-updated",(function(e){t.mined=e})),s.$on("planet-update",(function(){return t.fetchData()})),s.$on("planet-updated",(function(e){t.planet=e}))},computed:{isTransmutable:function(){return this.quantity>0&&this.quantity<=this.transmutableQuantity},transmutableQuantity:function(){var t=_.find(this.planet.resources,{id:this.selected.id}),e=_.get(t,"storage",0);return this.planet.resource_id===this.selected.id?e+Math.floor(this.mined):e+_.get(t,"quantity",0)},transmutableEnergy:function(){return this.isTransmutable?this.quantity*this.selected.efficiency:0}},watch:{isEnabled:function(){this.fetchData()}},methods:{fetchData:function(){var t=this;this.isEnabled&&axios.get(this.url.replace("__grid__",this.grid.id)).then((function(e){t.data=e.data,_.find(t.data.resources,t.selected)?t.quantity="":t.select(_.first(t.data.resources))}))},store:function(){axios.post(this.storeUrl.replace("__grid__",this.grid.id).replace("__resource__",this.selected.id),{quantity:this.quantity})},isSelected:function(t){return this.selected.id===t.id},select:function(t){this.selected=t,this.quantity=""}}}),wt=bt.extend({props:["grid","url"],components:{Movement:C},data:function(){return{data:{incoming_movements:[],outgoing_movements:[]}}},created:function(){var t=this;s.$on("planet-update",(function(){return t.fetchData()}))},computed:{isEmpty:function(){return!this.data.incoming_movements.length&&!this.data.outgoing_movements.length}},watch:{isEnabled:function(){this.fetchData()}},methods:{fetchData:function(){var t=this;this.isEnabled&&axios.get(this.url.replace("__grid__",this.grid.id)).then((function(e){t.data=e.data}))}}}),kt={props:["isEnabled","building","grid","close","planet","data","storeUrl"],mixins:[O],watch:{isEnabled:function(){this.quantity={}}},computed:{travelTime:function(){return Math.round(this.data.travel_time/this.slowestSupportUnitSpeed*(1-this.building.trade_time_bonus))}},methods:{support:function(){axios.post(this.storeUrl.replace("__grid__",this.grid.id),{quantity:this.quantity}).then(this.close)}}},$t={props:["isEnabled","building","grid","close","mined","planet","data","storeUrl","unitTypes"],mixins:[F],watch:{isEnabled:function(){this.quantity={}}},computed:{travelTime:function(){return Math.round(this.data.travel_time/this.transporterUnit.speed*(1-this.building.trade_time_bonus))}},methods:{transport:function(){axios.post(this.storeUrl.replace("__grid__",this.grid.id),{quantity:this.quantity}).then(this.close)},unitQuantity:function(t){return _.get(t,"storage",0)+_.get(t,"quantity",0)}}},jt=bt.extend({props:["grid","close","url"],components:{Patrol:kt,Trade:$t},mixins:[U],data:function(){return{selectedTab:"trade",mined:0,planet:{id:void 0,resource_id:void 0,resources:[],units:[]},data:{travel_time:0}}},created:function(){var t=this;s.$on("planet-updated",(function(e){t.planet=e})),s.$on("resource-updated",(function(e){t.mined=e}))},watch:{isEnabled:function(){this.fetchData()}},methods:{fetchData:function(){var t=this;this.isEnabled&&axios.get(this.url).then((function(e){t.data=e.data}))}}}),Tt=bt.extend({props:["grid","url","storeUrl","destroyUrl"],data:function(){return{isResearch:!1,energy:0,supply:0,quantity:"",selected:{id:void 0,supply:0,train_cost:0,train_time:0},data:{remaining:0,units:[]}}},created:function(){var t=this;s.$on("energy-updated",(function(e){t.energy=e})),s.$on("planet-update",(function(){return t.fetchData()})),s.$on("planet-updated",(function(e){t.supply=e.supply-e.used_supply-e.used_training_supply}))},computed:{isTrainable:function(){return this.quantity>0&&this.quantity<=this.trainableQuantity},trainableQuantity:function(){return Math.floor(Math.min(this.energy/this.selected.train_cost,this.supply/this.selected.supply))},trainName:function(){return"".concat(this.data.quantity," x ").concat(this.selected.name)},trainTime:function(){return this.isTrainable?this.quantity*this.selected.train_time:0}},watch:{isEnabled:function(){this.fetchData()}},methods:{fetchData:function(){var t=this;this.isEnabled&&axios.get(this.url.replace("__grid__",this.grid.id)).then((function(e){t.data=e.data,t.initRemaining(t.data.remaining),_.find(t.data.units,t.selected)?t.quantity="":t.select(_.first(t.data.units))}))},store:function(){axios.post(this.storeUrl.replace("__grid__",this.grid.id).replace("__unit__",this.selected.id),{quantity:this.quantity})},destroy:function(){axios.delete(this.destroyUrl.replace("__grid__",this.grid.id))},isSelected:function(t){return this.selected.id===t.id},select:function(t){this.selected=t,this.quantity=""}}}),Ut=o.extend({props:["centralType","url","storeUrl","destroyUrl"],components:{Producer:xt,Scout:wt,Trader:jt,Trainer:Tt},data:function(){return{isCapitalPlanet:!1,energy:0,grid:{id:void 0,building_id:void 0},data:{has_training:!1,remaining:0,building:{},upgrade:{}}}},created:function(){var t=this;s.$on("building-click",this.open),s.$on("energy-updated",(function(e){t.energy=e})),s.$on("planet-update",(function(){return t.fetchData()})),s.$on("planet-updated",(function(e){t.isCapitalPlanet=e.is_capital}))},computed:{canConstruct:function(){return this.energy>=this.data.upgrade.construction_cost},canDemolish:function(){return!(this.data.has_training||this.remaining||this.isCapitalPlanet&&this.data.building.type===this.centralType)},building:function(){return this.data.building}},methods:{open:function(t){this.data={has_training:!1,remaining:0,building:{},upgrade:{}},this.grid=t,this.fetchData(!0)},openDemolish:function(){var t=this;this.openAfterHidden((function(){return s.$emit("demolish-open",t.grid)}))},fetchData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(e||this.isEnabled)&&axios.get(this.url.replace("__grid__",this.grid.id)).then((function(n){t.data=n.data,t.initRemaining(t.data.remaining),e&&t.$nextTick((function(){return t.$modal.modal()}))}))},store:function(){var t=this;axios.post(this.storeUrl.replace("__grid__",this.grid.id)).then((function(){t.close(),s.$emit("planet-update")}))},destroy:function(){var t=this;axios.delete(this.destroyUrl.replace("__grid__",this.grid.id)).then((function(){t.close(),s.$emit("planet-update")}))}}}),Mt=o.extend({props:["url","storeUrl"],data:function(){return{energy:0,data:{has_solarion:!0,upgrade_count:0,upgrade_cost:0}}},created:function(){var t=this;s.$on("upgrade-all-open",this.open),s.$on("energy-updated",(function(e){t.energy=e}))},computed:{canStore:function(){return this.data.has_solarion&&this.data.upgrade_cost&&this.energy>=this.data.upgrade_cost}},methods:{open:function(){this.fetchData(!0)},fetchData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(e||this.isEnabled)&&axios.get(this.url).then((function(n){t.data=n.data,e&&t.$nextTick((function(){return t.$modal.modal()}))}))},store:function(){axios.post(this.storeUrl).then(this.close)}}});n(9147),i.default.filter("bracket",m),i.default.filter("fromNow",g),i.default.filter("item",v),i.default.filter("number",y),i.default.filter("percent",b),i.default.filter("sign",x),i.default.filter("timer",w),i.default.directive("popover",Q),i.default.use(a.Z);var St=new a.Z({mode:"history",routes:[{path:"/starmap",name:"starmap",component:at,props:!0},{path:"/",name:"home",component:_t,props:!0}]});St.afterEach((function(t){i.default.nextTick((function(){$(".modal.show").modal("hide"),$(".modal-backdrop").remove(),$("body").removeClass("modal-open").css({overflow:"","padding-right":""})})),"starmap"===t.name&&i.default.nextTick((function(){requestAnimationFrame((function(){window.__starmap&&window.__starmap.invalidateSize(!0)}))}))})),i.default.config.errorHandler=function(t,e,n){console.error("[Vue error]",n,t)};try{new i.default({router:St,components:{Bookmark:c,Construction:u,Demolish:d,Mailbox:M,Message:P,Monitor:E,Mothership:B,Move:Y,Navigation:H,Planet:J,Player:X,Profile:W,Setting:V,Sidebar:tt,Star:et,Trophy:yt,Upgrade:Ut,UpgradeAll:Mt},mixins:[z]}).$mount("#app");"function"==typeof window.__cancelFallbackBar&&window.__cancelFallbackBar()}catch(t){console.error("[Vue mount failed]",t);var Pt=document.getElementById("app");Pt&&(Pt.innerHTML='<div style="color:#fff;background:#1a1a2e;padding:40px;text-align:center;font-family:sans-serif;"><h2>Loading Error</h2><p>The application could not start. Please try reloading the page.</p><p><a href="/login" style="color:#4fc3f7;">Back to Login</a> | <a href="/logout" style="color:#4fc3f7;">Logout</a></p><p style="font-size:12px;color:#888;">'+t.message+"</p></div>")}},9147:(t,e,n)=>{"use strict";n.r(e);var i=n(4554);window._=n(6486);try{window.Popper=n(8981).default,window.$=window.jQuery=n(9755),n(3734)}catch(t){}window.axios=n(9669),window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";var a=document.head.querySelector('meta[name="csrf-token"]');a?window.axios.defaults.headers.common["X-CSRF-TOKEN"]=a.content:console.error("CSRF token not found: https://laravel.com/docs/csrf#csrf-x-csrf-token");try{window.Pusher=n(6606),window.PUSHER_APP_KEY?window.Echo=new i.Z({broadcaster:"pusher",key:window.PUSHER_APP_KEY,wsHost:window.location.hostname,wsPort:window.location.port,wsPath:"/ws",disableStats:!0,enabledTransports:["ws","wss"]}):console.warn("PUSHER_APP_KEY not set  real-time features disabled.")}catch(t){console.warn("Echo/Pusher init failed  real-time features disabled:",t.message)}window.Vue=n(538),window.Swal=n(6455),window.moment=n(381),moment.locale(document.querySelector("html").getAttribute("lang")),n(5243),n(1134),n(4772),function(){function t(){document.documentElement.style.setProperty("--app-vh",window.innerHeight+"px")}t(),window.addEventListener("resize",t),window.addEventListener("orientationchange",(function(){setTimeout(t,150)}))}(),window.axios.interceptors.response.use(null,(function(t){var e=_.get(t.response,"status");return 419===e?Swal.fire({icon:"warning",title:Translations.error.whoops,text:"Session expired. The page will reload.",showConfirmButton:!1,timer:1500}).then((function(){window.location.reload()})):401===e?window.location.href="/login":403===e?Swal.fire({icon:"warning",title:Translations.error.whoops,text:"Permission denied.",showConfirmButton:!1,timer:1500}):422===e||e>=500&&Swal.fire({icon:"error",title:Translations.error.whoops,text:Translations.error.wrong,showConfirmButton:!1,timer:1500}),Promise.reject(t)}))},4308:()=>{},6700:(t,e,n)=>{var i={"./af":2786,"./af.js":2786,"./ar":867,"./ar-dz":4130,"./ar-dz.js":4130,"./ar-kw":6135,"./ar-kw.js":6135,"./ar-ly":6440,"./ar-ly.js":6440,"./ar-ma":7702,"./ar-ma.js":7702,"./ar-sa":6040,"./ar-sa.js":6040,"./ar-tn":7100,"./ar-tn.js":7100,"./ar.js":867,"./az":1083,"./az.js":1083,"./be":9808,"./be.js":9808,"./bg":8338,"./bg.js":8338,"./bm":7438,"./bm.js":7438,"./bn":8905,"./bn-bd":6225,"./bn-bd.js":6225,"./bn.js":8905,"./bo":1560,"./bo.js":1560,"./br":1278,"./br.js":1278,"./bs":622,"./bs.js":622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":877,"./cv.js":877,"./cy":7373,"./cy.js":7373,"./da":4780,"./da.js":4780,"./de":9740,"./de-at":217,"./de-at.js":217,"./de-ch":894,"./de-ch.js":894,"./de.js":9740,"./dv":5300,"./dv.js":5300,"./el":837,"./el.js":837,"./en-au":8348,"./en-au.js":8348,"./en-ca":7925,"./en-ca.js":7925,"./en-gb":2243,"./en-gb.js":2243,"./en-ie":6436,"./en-ie.js":6436,"./en-il":7207,"./en-il.js":7207,"./en-in":4175,"./en-in.js":4175,"./en-nz":6319,"./en-nz.js":6319,"./en-sg":1662,"./en-sg.js":1662,"./eo":2915,"./eo.js":2915,"./es":5655,"./es-do":5251,"./es-do.js":5251,"./es-mx":6112,"./es-mx.js":6112,"./es-us":1146,"./es-us.js":1146,"./es.js":5655,"./et":5603,"./et.js":5603,"./eu":7763,"./eu.js":7763,"./fa":6959,"./fa.js":6959,"./fi":1897,"./fi.js":1897,"./fil":2549,"./fil.js":2549,"./fo":4694,"./fo.js":4694,"./fr":4470,"./fr-ca":3049,"./fr-ca.js":3049,"./fr-ch":2330,"./fr-ch.js":2330,"./fr.js":4470,"./fy":5044,"./fy.js":5044,"./ga":9295,"./ga.js":9295,"./gd":2101,"./gd.js":2101,"./gl":8794,"./gl.js":8794,"./gom-deva":7884,"./gom-deva.js":7884,"./gom-latn":3168,"./gom-latn.js":3168,"./gu":5349,"./gu.js":5349,"./he":4206,"./he.js":4206,"./hi":94,"./hi.js":94,"./hr":316,"./hr.js":316,"./hu":2138,"./hu.js":2138,"./hy-am":1423,"./hy-am.js":1423,"./id":9218,"./id.js":9218,"./is":135,"./is.js":135,"./it":626,"./it-ch":150,"./it-ch.js":150,"./it.js":626,"./ja":9183,"./ja.js":9183,"./jv":4286,"./jv.js":4286,"./ka":2105,"./ka.js":2105,"./kk":7772,"./kk.js":7772,"./km":8758,"./km.js":8758,"./kn":9282,"./kn.js":9282,"./ko":3730,"./ko.js":3730,"./ku":1408,"./ku.js":1408,"./ky":3291,"./ky.js":3291,"./lb":6841,"./lb.js":6841,"./lo":5466,"./lo.js":5466,"./lt":7010,"./lt.js":7010,"./lv":7595,"./lv.js":7595,"./me":9861,"./me.js":9861,"./mi":5493,"./mi.js":5493,"./mk":5966,"./mk.js":5966,"./ml":7341,"./ml.js":7341,"./mn":5115,"./mn.js":5115,"./mr":370,"./mr.js":370,"./ms":9847,"./ms-my":1237,"./ms-my.js":1237,"./ms.js":9847,"./mt":2126,"./mt.js":2126,"./my":6165,"./my.js":6165,"./nb":4924,"./nb.js":4924,"./ne":6744,"./ne.js":6744,"./nl":3901,"./nl-be":9814,"./nl-be.js":9814,"./nl.js":3901,"./nn":3877,"./nn.js":3877,"./oc-lnc":2135,"./oc-lnc.js":2135,"./pa-in":5858,"./pa-in.js":5858,"./pl":4495,"./pl.js":4495,"./pt":9520,"./pt-br":7971,"./pt-br.js":7971,"./pt.js":9520,"./ro":6459,"./ro.js":6459,"./ru":1793,"./ru.js":1793,"./sd":950,"./sd.js":950,"./se":490,"./se.js":490,"./si":124,"./si.js":124,"./sk":4249,"./sk.js":4249,"./sl":4985,"./sl.js":4985,"./sq":1104,"./sq.js":1104,"./sr":9131,"./sr-cyrl":9915,"./sr-cyrl.js":9915,"./sr.js":9131,"./ss":5893,"./ss.js":5893,"./sv":8760,"./sv.js":8760,"./sw":1172,"./sw.js":1172,"./ta":7333,"./ta.js":7333,"./te":3110,"./te.js":3110,"./tet":2095,"./tet.js":2095,"./tg":7321,"./tg.js":7321,"./th":9041,"./th.js":9041,"./tk":9005,"./tk.js":9005,"./tl-ph":5768,"./tl-ph.js":5768,"./tlh":9444,"./tlh.js":9444,"./tr":2397,"./tr.js":2397,"./tzl":8254,"./tzl.js":8254,"./tzm":1106,"./tzm-latn":699,"./tzm-latn.js":699,"./tzm.js":1106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":7691,"./uk.js":7691,"./ur":3795,"./ur.js":3795,"./uz":6791,"./uz-latn":588,"./uz-latn.js":588,"./uz.js":6791,"./vi":5666,"./vi.js":5666,"./x-pseudo":4378,"./x-pseudo.js":4378,"./yo":5805,"./yo.js":5805,"./zh-cn":3839,"./zh-cn.js":3839,"./zh-hk":5726,"./zh-hk.js":5726,"./zh-mo":9807,"./zh-mo.js":9807,"./zh-tw":4152,"./zh-tw.js":4152};function a(t){var e=s(t);return n(e)}function s(t){if(!n.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}a.keys=function(){return Object.keys(i)},a.resolve=s,t.exports=a,a.id=6700}},t=>{"use strict";var e=e=>t(t.s=e);t.O(void 0,[170,898],(()=>(e(8430),e(4308))))}]);